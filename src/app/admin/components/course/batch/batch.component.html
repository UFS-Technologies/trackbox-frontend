
@if(isLoading){
  <app-loading [isLoading]="isLoading"></app-loading>
  
  <!-- <div class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50">
      <div class="flex flex-col items-center">
        <div class="w-16 h-16 border-t-4 border-b-4 border-blue-500 rounded-full animate-spin"></div>
      </div>
    </div> -->
  }
@if(!Entry_View)
  {
  <section class="border border-gray-300 shadow p-6 rounded-lg bg-white">
    <div class="flex justify-between mb-4">
      <button class="bg-sky-500 hover:bg-blue-hover text-white font-bold py-2 px-4 rounded" (click)="Create_New()">
        Add  Batch
      </button>
      <button class="border border-blue hover:bg-gray-500 hover:text-white text-black font-bold py-2 px-4 rounded" (click)="onClose()">
      Close
    </button>
  </div>
  @for( item of batch_Data;track $index){
    <div class="mt-4 border border-gray-200 p-4 rounded-md">
      <div class="flex justify-between items-start">
        <div class="w-full">
          <!-- Batch Info -->
          <div class="mb-2">
            <span class="text-sm text-gray-500">Batch Name</span>
            <div class="text-base font-medium text-gray-700">{{ item.Batch_Name }}</div>
          </div>
  
          <div class="mb-2">
            <span class="text-sm text-gray-500">Start Date</span>
            <div class="text-base font-medium text-gray-700">{{ item.Start_Date }}</div>
          </div>
  
          <div class="mb-2">
            <span class="text-sm text-gray-500">End Date</span>
            <div class="text-base font-medium text-gray-700">{{ item.End_Date }}</div>
          </div>
  
          <!-- Teacher Info -->
          <div class="mb-2">
            <span class="text-sm text-gray-500">Group Class Faculty</span>
            <div class="text-base font-medium text-gray-700">{{ item.teachers ? item.teachers : 'No Group Call' }}</div>
          </div>
  
          <!-- Time Slot Info -->
          <div class="mb-2">
            <ng-container *ngIf="item.time_slots && item.time_slots.length > 0">
            <span class="text-sm text-gray-500">Group Time Slot</span>
            <div class="text-base font-medium text-gray-700">
              <!-- Time Slots -->
                <ul class="space-y-1">
                  <li *ngFor="let slot of item.time_slots" class="text-sm text-gray-600">
                    {{ slot.start_time }} - {{ slot.end_time }}
                  </li>
                </ul>
                <!-- No Time Slot Message -->
                
              </div>
            </ng-container>
          </div>
        </div>
  
        <!-- Action Buttons -->
        <div class="flex gap-2 items-center">
          <button (click)="Get_Batch_Students(item)" class="flex items-center h-10 px-4 py-2 bg-green-50 text-green-700 rounded-md hover:bg-green-100 transition-all duration-300 transform hover:scale-105 whitespace-nowrap min-w-[120px]">
            <span class="material-symbols-outlined mr-2">people</span>
            <span class="font-medium">Batch Students</span>
        </button>
        <button (click)="Edit_Batch(item)" class="flex items-center px-4 py-2 h-10  bg-yellow-50 text-yellow-700 rounded-md hover:bg-yellow-100 transition-all duration-300 transform hover:scale-105">
          <span class="material-symbols-outlined mr-2">edit</span>
          <!-- <span class="font-medium">Edit</span> -->
        </button>
        <button (click)="Delete_Batch(item.Batch_ID, $index)"  class="flex items-center px-4 py-2 h-10 bg-red-50 text-red-700 rounded-md hover:bg-red-100 transition-all duration-300 transform hover:scale-105">
          <span class="material-symbols-outlined mr-2">delete</span>
          <!-- <span class="font-medium">Delete</span> -->
        </button>
       
        </div>
      </div>
    </div>
  }
  
  </section>
}

@else if(batchStudentsView)
{

  <div class="container mx-auto px-4 py-8">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">{{this.BatchName}}  Students</h2>
    <div class="w-100 flex justify-end">

      <button class="border border-blue hover:bg-gray-500 hover:text-white text-black font-bold py-2 px-4 rounded" (click)="closeClick()">
        Close
      </button>
    </div>
    <!-- Student Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div *ngFor="let student of BatchStudentList" 
      class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
   
   <!-- Student Header with Image -->
   <div class="flex items-center p-4 border-b border-gray-200">
     <div class="relative w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex-shrink-0">
       <img *ngIf="student.Profile_Photo_Path" 
            [src]="filepath + student.Profile_Photo_Path"
            class="w-full h-full object-cover"
            alt="Profile photo"
            (error)="onImageError($event)">
       <div *ngIf="!student.Profile_Photo_Path" 
            class="w-full h-full flex items-center justify-center bg-indigo-100 text-indigo-600 text-xl font-bold">
         {{getInitials(student)}}
       </div>
     </div>
     
     <!-- Student Name -->
     <div class="ml-4">
       <h3 class="font-semibold text-lg text-gray-800">
         {{student.First_Name}} {{student.Last_Name}}
       </h3>
     </div>
   </div>
   
   <!-- Student Details -->
   <div class="p-4 space-y-3">
     <!-- Email -->
     <div class="flex items-center text-sm">
       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
       </svg>
       <span class="text-gray-600">{{student.Email || 'No email provided'}}</span>
     </div>
     
     <!-- Phone -->
     <div class="flex items-center text-sm">
       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
       </svg>
       <span class="text-gray-600">{{student.Phone_Number || 'No phone provided'}}</span>
     </div>
 
     <!-- Teacher Info -->
     <div *ngIf="student.TeacherName" class="mt-4 p-3 bg-gray-50 rounded-md">
       <div class="flex items-center text-sm mb-2">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
         </svg>
         <span class="text-gray-700 font-medium">{{student.TeacherName}}</span>
       </div>
       <div class="flex items-center text-sm">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
         <span class="text-gray-600">
           {{student.TeacherSlotStartTime}} - {{student.TeacherSlotEndTime}}
         </span>
       </div>
     </div>
   </div>
 </div>
    

    </div>
    @if(BatchStudentList.length === 0 && !isLoading) {
      <div class="flex flex-col items-center justify-center p-8 text-center">
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          class="w-16 h-16 text-gray-400 mb-4" 
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor">
          <path 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" 
          />
        </svg>
        <p class="text-lg text-gray-600 font-medium">No Students Have Been Assigned</p>
        <p class="text-sm text-gray-500 mt-2">Students will appear here once they are assigned to this batch.</p>
      </div>
    }
  </div>
}
@else {
<section class="border border-gray-300 shadow p-6 rounded-lg bg-white">
  <form [formGroup]="batch_Form" (ngSubmit)="Save_Batch();submitted = true">
    <div class="mb-4">
      <label  class="block text-sm font-medium text-gray-700"> Course <span class="text-red-700">*</span></label>
      <select (change)="onSelectChange($event)" id="Course" formControlName="Course_ID" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50">
        @for (Course of CourseList; track Course; let i = $index) {
          <option [value]="Course['Course_ID']">
            {{ Course['Course_Name'] }}
          </option>
        }
      </select>    
      @if (getErrorMessage('Course_ID')) {
     
        <span class="text-red-500">
          Course Name is required
        </span>
      }
    </div>
    <div class="mb-4">
      <label  class="block text-sm font-medium text-gray-700"> Batch Name <span class="text-red-700">*</span></label>
      <input type="text" id="Batch_Name" name="Batch_Name" formControlName="Batch_Name" maxlength="50" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50" />

      @if (getErrorMessage('Batch_Name')) {
     
        <span class="text-red-500">
          Batch Name is required
        </span>
      }
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">
        Start Date <span class="text-red-700">*</span>
      </label>
      <input
        type="date"
        [min]="minStartDate"
        [max]="maxDate"
        formControlName="Start_Date"
        class="mt-1 px-2 py-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50"
      />
      <span class="text-red-500" *ngIf="batch_Form.get('Start_Date')?.hasError('required')">
        {{ formErrors.Start_Date.required }}
      </span>
      <span class="text-red-500" *ngIf="batch_Form.get('Start_Date')?.hasError('invalidFormat')">
        {{ formErrors.Start_Date.invalidFormat }}
      </span>
      <span class="text-red-500" *ngIf="batch_Form.get('Start_Date')?.hasError('minDate')">
        {{ formErrors.Start_Date.minDate }}
      </span>
      <span class="text-red-500" *ngIf="batch_Form.get('Start_Date')?.hasError('maxDate')">
        {{ formErrors.Start_Date.maxDate }}
      </span>
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">
        End Date <span class="text-red-700">*</span>
      </label>
      <input
        type="date"
        [min]="minStartDate"
        [max]="maxDate"
        formControlName="End_Date"
        class="mt-1 px-2 py-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50"
      />
      <span class="text-red-500" *ngIf="batch_Form.get('End_Date')?.hasError('required')">
        {{ formErrors.End_Date.required }}
      </span>
      <span class="text-red-500" *ngIf="batch_Form.get('End_Date')?.hasError('invalidFormat')">
        {{ formErrors.End_Date.invalidFormat }}
      </span>
      <span class="text-red-500" *ngIf="batch_Form.get('End_Date')?.hasError('minDate')">
        {{ formErrors.End_Date.minDate }}
      </span>
      <span class="text-red-500" *ngIf="batch_Form.get('End_Date')?.hasError('maxDate')">
        {{ formErrors.End_Date.maxDate }}
      </span>
      <span class="text-red-500" *ngIf="batch_Form.get('End_Date')?.hasError('invalidRange')">
        {{ formErrors.End_Date.invalidRange }}
      </span>
    </div>
    
    
    <!-- <div class="flex items-center mb-3">
      <input type="checkbox" id="isGroupCall" 
             (change)="onGroupCallChange($event)" 
             [checked]="scheduledTeachers.length > 0" 
             class="mr-2">
      <label for="isGroupCall" class="text-gray-700">Is Group Call Involved</label>
    </div> -->
    <div formArrayName="scheduledTeachers" class="col-span-2 flex flex-wrap gap-5">
      @for (teacherGroup of scheduledTeachers.controls; track teacherGroup; let i = $index) {
        @if(!teacherGroup.get('Delete_Status')?.value) {
        <div [formGroupName]="i" class="border p-4 rounded">
          <mat-form-field>
            <mat-label>Select Faculty</mat-label>
            <mat-select formControlName="Teacher_ID" >
              @for (teacher of teacherDatas(); track teacher) {
                <mat-option [value]="teacher['User_ID']">
                  {{ teacher['First_Name'] }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        
            <div formArrayName="timeSlots">
              @for (timeSlot of getTimeSlots(teacherGroup); track timeSlot; let j = $index) {
                @if(!timeSlot.get('Delete_Status')?.value) {

                <div [formGroupName]="j" class="flex gap-2 mb-2">
                  <div class="editable-dial-example flex flex-col gap-4 p-4">
                    <!-- Start Time Input -->
                    <div class="relative">
                        <label for="start-time" class="block text-sm font-medium text-gray-700 mb-2">
                            Start Time
                        </label>
                        <input
                            id="start-time"
                            placeholder="Start Time"
                            formControlName="startTime"
                            aria-label="Start Time"
                            [ngxTimepicker]="editableDial"
                            readonly
                            class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 placeholder-gray-400"
                        />
                        <ngx-material-timepicker #editableDial></ngx-material-timepicker>
                        @if (timeSlot.get('startTime')?.invalid && (timeSlot.get('startTime')?.touched || submitted)) {
                          <p class="text-red-500 text-sm mt-1">Start time is required</p>
                        }
                    </div>
                
                    <!-- End Time Input -->
                    <div class="relative">
                        <label for="end-time" class="block text-sm font-medium text-gray-700 mb-2">
                            End Time
                        </label>
                        <input
                            id="end-time"
                            placeholder="End Time"
                            formControlName="endTime"
                            aria-label="End Time"
                            [ngxTimepicker]="editableDial2"
                            readonly
                            class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 placeholder-gray-400"
                        />
                        <ngx-material-timepicker #editableDial2></ngx-material-timepicker>
                        @if (timeSlot.get('endTime')?.invalid && (timeSlot.get('endTime')?.touched || submitted)) {
                          <p class="text-red-500 text-sm mt-1">Start time is required</p>
                        }
                    </div>
                </div>
             
                  @if(countActiveTimeSlots(teacherGroup) > 1) {
                  <button mat-icon-button color="warn" (click)="removeTimeSlot(i, j,timeSlot)">
                    <mat-icon>delete</mat-icon>
                  </button>
                  }
                </div>
              }}
              <button 
              class="bg-gray-500 text-white font-semibold py-2 px-4 rounded shadow hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50 transition ease-in-out duration-150"
              (click)="addTimeSlot(i); submitted = false">
              Add Time Slot
            </button>
                        </div>
          
          <!-- @if(countActiveTeachers() > 1) { -->

          <button mat-icon-button color="warn" (click)="removeTeacher(i,teacherGroup)">
            <mat-icon>delete</mat-icon>
          </button>
        <!-- } -->
        </div>
      }
    
      }
      @if (getErrorMessage('scheduledTeachers')) {
        <span class="text-red-500">
      {{getErrorMessage('scheduledTeachers')}}
        </span>
      }
    
    
    
      <button   class="bg-gray-500 h-full text-white font-semibold py-2 px-4 rounded shadow hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50 transition ease-in-out duration-150" (click)="addTeacher();submitted = false">Add Faculty</button>
      <!-- @if(isScheduledTeachersEmptyOrDeleted()){

        <button   class="bg-gray-500 h-full text-white font-semibold py-2 px-4 rounded shadow hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50 transition ease-in-out duration-150" (click)="addTeacher();submitted = false">Add Faculty</button>
      } -->
    </div>

    <!-- Add this section before the final buttons -->
<div class="mt-6 mb-4">
  <h3 class="text-lg font-medium text-gray-900 mb-4">Assigned Teachers</h3>
  
  <div class="grid gap-4">
    @for (teacher of oneOnone_teacherlist; track teacher) {
      <div class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
        <div class="flex justify-between items-start">
          <div>
            <h4 class="font-medium text-gray-900">{{teacher['TeacherName']}}</h4>
            <div class="mt-2">
              <span class="text-sm text-gray-600 font-medium">Students:</span>
              <span class="text-sm text-gray-800 ml-1">{{teacher['Students']}}</span>
            </div>
            <div class="mt-1 flex gap-4">
              <div>
                <span class="text-sm text-gray-600">Start Time:</span>
                <span class="text-sm text-gray-800 ml-1">{{teacher['StartTimes']}}</span>
              </div>
              <div>
                <span class="text-sm text-gray-600">End Time:</span>
                <span class="text-sm text-gray-800 ml-1">{{teacher['EndTimes']}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    }

  </div>
</div>


    <div class="w-full flex justify-end gap-4">
      <button class="border border-blue hover:bg-gray-500 hover:text-white text-black font-bold py-2 px-4 rounded" (click)="closeClick();submitted = false">
        Cancel
      </button>
      <button type="submit" class="bg-sky-500 hover:bg-blue-hover text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring focus:ring-zinc-500 focus:ring-opacity-50">
        Save
      </button>
    </div>
  </form>
</section>
}
